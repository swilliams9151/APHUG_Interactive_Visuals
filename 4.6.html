<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APHG Topic 4.6: Redistricting & Gerrymandering</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .voter {
            transition: all 0.3s ease;
        }
        .district-border {
            transition: all 0.5s ease;
            fill: none;
            stroke-width: 4;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        
        /* Animation for changing maps */
        @keyframes drawLine {
            from { stroke-dashoffset: 1000; }
            to { stroke-dashoffset: 0; }
        }
        .animate-draw {
            stroke-dasharray: 1000;
            animation: drawLine 1.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Header -->
    <header class="bg-indigo-800 text-white p-6 shadow-lg">
        <div class="max-w-5xl mx-auto">
            <h1 class="text-3xl font-extrabold">Topic 4.6: Internal Boundaries</h1>
            <p class="text-indigo-200 font-medium mt-1">Voting Districts, Redistricting, and Gerrymandering</p>
        </div>
    </header>

    <main class="max-w-5xl mx-auto p-6 grid lg:grid-cols-2 gap-8">

        <!-- LEFT: The Simulator -->
        <section class="bg-white rounded-2xl shadow-xl p-6 border border-slate-200">
            <div class="flex justify-between items-end mb-6">
                <div>
                    <h2 class="text-xl font-bold text-gray-800">The Redistricting Lab</h2>
                    <p class="text-sm text-gray-500">Population: 15 Blue (60%), 10 Red (40%)</p>
                </div>
                <div class="text-right">
                    <span class="text-xs font-bold uppercase text-gray-400 tracking-wider">Winner</span>
                    <div id="election-winner" class="text-2xl font-bold text-blue-600">Blue Wins</div>
                </div>
            </div>

            <!-- Visualization Container -->
            <div class="relative w-full aspect-square max-w-md mx-auto bg-slate-100 rounded-xl overflow-hidden mb-6">
                
                <!-- Voter Grid (5x5) -->
                <div id="voter-grid" class="absolute inset-0 grid grid-cols-5 grid-rows-5 p-4 gap-4 z-0">
                    <!-- Voters injected via JS -->
                </div>

                <!-- SVG Overlay for Districts -->
                <svg id="district-overlay" class="absolute inset-0 w-full h-full pointer-events-none z-10" viewBox="0 0 500 500">
                    <!-- District lines injected via JS -->
                </svg>

                <!-- District Labels Overlay -->
                <div id="district-labels" class="absolute inset-0 z-20 pointer-events-none">
                    <!-- Labels injected via JS -->
                </div>
            </div>

            <!-- Scoreboard -->
            <div class="flex gap-2 mb-6">
                <div class="flex-1 bg-blue-50 border border-blue-200 rounded p-3 text-center">
                    <span class="block text-xs font-bold text-blue-400 uppercase">Blue Districts</span>
                    <span id="score-blue" class="text-2xl font-bold text-blue-700">3</span>
                </div>
                <div class="flex-1 bg-red-50 border border-red-200 rounded p-3 text-center">
                    <span class="block text-xs font-bold text-red-400 uppercase">Red Districts</span>
                    <span id="score-red" class="text-2xl font-bold text-red-700">2</span>
                </div>
            </div>

            <!-- Controls -->
            <div class="grid grid-cols-3 gap-2">
                <button onclick="setScenario('fair')" id="btn-fair" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 font-bold text-sm transition">
                    Fair Map
                </button>
                <button onclick="setScenario('crack')" id="btn-crack" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50 font-bold text-sm transition">
                    Crack Red
                </button>
                <button onclick="setScenario('pack')" id="btn-pack" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50 font-bold text-sm transition">
                    Pack Blue
                </button>
            </div>
            <p id="scenario-desc" class="mt-4 text-sm text-gray-600 italic text-center bg-gray-50 p-2 rounded">
                Boundaries follow logical lines. Results match the population (60% Blue, 40% Red).
            </p>
        </section>

        <!-- RIGHT: Educational Content -->
        <div class="space-y-6">
            
            <!-- Mechanics Explanation -->
            <section class="bg-slate-800 text-white rounded-xl shadow-xl p-6">
                <h3 class="text-xl font-bold text-yellow-400 mb-4">How to Steal an Election</h3>
                <div class="space-y-4">
                    <div class="flex gap-3">
                        <div class="text-2xl">ðŸ”¨</div>
                        <div>
                            <h4 class="font-bold">Cracking (Dilution)</h4>
                            <p class="text-sm text-slate-300">Spreading opposition voters across many districts so they never have a majority in any of them. Their votes are "wasted" as minorities.</p>
                        </div>
                    </div>
                    <div class="flex gap-3">
                        <div class="text-2xl">ðŸ“¦</div>
                        <div>
                            <h4 class="font-bold">Packing (Concentration)</h4>
                            <p class="text-sm text-slate-300">Concentrating opposition voters into a single district to allow them to win huge there, but lose everywhere else. "Sacrifice one to win four."</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Real-World Examples (NEW) -->
            <section class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="bg-gray-50 p-4 border-b border-gray-200">
                    <h3 class="font-bold text-gray-800">Real-Life "Hall of Shame"</h3>
                    <p class="text-xs text-gray-500">Famous examples of odd district shapes.</p>
                </div>
                <div class="p-4 space-y-4">
                    <div class="border-l-4 border-blue-500 pl-3 hover:bg-blue-50 transition p-2 rounded-r">
                        <h4 class="font-bold text-sm text-gray-900">Illinois 4th ("The Earmuffs")</h4>
                        <p class="text-xs text-gray-600 mt-1">
                            Connects two distinct Hispanic neighborhoods in Chicago using a thin strip of highway.
                            <br><span class="text-blue-600 font-semibold">Reason:</span> Created a "Majority-Minority" district to ensure Latino representation (Voting Rights Act).
                        </p>
                    </div>
                    <div class="border-l-4 border-purple-500 pl-3 hover:bg-purple-50 transition p-2 rounded-r">
                        <h4 class="font-bold text-sm text-gray-900">Maryland 3rd ("The Praying Mantis")</h4>
                        <p class="text-xs text-gray-600 mt-1">
                            Often cited as one of the most gerrymandered districts in the US.
                            <br><span class="text-purple-600 font-semibold">Reason:</span> Partisan Gerrymandering designed to pack/crack Republicans to ensure a Democrat win.
                        </p>
                    </div>
                    <div class="border-l-4 border-red-500 pl-3 hover:bg-red-50 transition p-2 rounded-r">
                        <h4 class="font-bold text-sm text-gray-900">North Carolina 12th ("The Snake")</h4>
                        <p class="text-xs text-gray-600 mt-1">
                            Historically snaked along I-85 for 100+ miles.
                            <br><span class="text-red-600 font-semibold">Reason:</span> Originally drawn to gather African American voters; later defended as a partisan gerrymander.
                        </p>
                    </div>
                    <div class="border-l-4 border-green-500 pl-3 hover:bg-green-50 transition p-2 rounded-r">
                        <h4 class="font-bold text-sm text-gray-900">Texas 2nd ("The Crenshaw District")</h4>
                        <p class="text-xs text-gray-600 mt-1">
                            Wraps around Houston in a thin 'C' shape.
                            <br><span class="text-green-600 font-semibold">Reason:</span> Designed to pick up specific suburban voters while avoiding urban centers.
                        </p>
                    </div>
                </div>
            </section>

             <!-- Key Definitions -->
             <section class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="bg-gray-50 p-4 border-b border-gray-200">
                    <h3 class="font-bold text-gray-800">Key Vocabulary</h3>
                </div>
                <div class="p-4 space-y-4">
                    <div>
                        <h4 class="font-bold text-indigo-600 text-sm uppercase">Voting District</h4>
                        <p class="text-sm text-gray-600">A geographical area represented by a seat or seat(s) in a legislative body.</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-indigo-600 text-sm uppercase">Redistricting</h4>
                        <p class="text-sm text-gray-600">The process of drawing electoral district boundaries in the United States, usually done every 10 years after the census.</p>
                    </div>
                </div>
            </section>

        </div>

    </main>

    <script>
        // --- Configuration ---
        // 5x5 Grid. 0-24 indices.
        // Population: 15 Blue (B), 10 Red (R).
        // Fixed layout for consistent demonstration.
        const voterLayout = [
            'B','B','B','R','R',
            'B','B','R','R','R',
            'B','B','R','R','B',
            'B','B','B','B','B',
            'R','R','B','R','R' 
        ];
        
        // We need 15 Blue and 10 Red total. Let's tweak layout to make geometries work nicely.
        // New Fixed Layout (Row by Row):
        // Row 1: B B B R R
        // Row 2: B B R R R
        // Row 3: B B R B B
        // Row 4: B B B B B
        // Row 5: R R R R B
        // Total: B=15, R=10. Correct.

        const scenarios = {
            'fair': {
                // Vertical-ish columns representing mixed pop
                // District 1 (Left col): 5B -> Blue
                // District 2 (Mid-Left): 5B -> Blue
                // District 3 (Mid): 2B, 3R -> Red
                // District 4 (Mid-Right): 2B, 3R -> Red
                // District 5 (Right): 1B, 4R -> Wait, total R is 10.
                // Let's just define the district groups (indices)
                districts: [
                    [0,1,5,6,10],    // Top Left Block (B:5, R:0) -> BLUE
                    [2,3,4,8,9],     // Top Right Block (B:1, R:4) -> RED
                    [15,16,20,21,22],// Bottom Left (B:2, R:3) -> RED
                    [7,11,12,13,17], // Middle Snake (B:3, R:2) -> BLUE
                    [14,18,19,23,24] // Bottom Right (B:4, R:1) -> BLUE
                ],
                // Wait, let's ensure the math works with my specific grid string above.
                // Let's rethink. Simplest way is to define the grid AND the groups per scenario.
                // But we want the VOTERS to stay in fixed locations to prove the point.
                
                // Let's use a simpler layout that makes geometric drawing easier.
                // Vertical Columns.
                // Col 1: B B B B B (5B) -> Blue
                // Col 2: B B B B R (4B 1R) -> Blue
                // Col 3: B B B R R (3B 2R) -> Blue
                // Col 4: R R R R R (5R) -> Red
                // Col 5: R R B B R (2B 3R) -> Red
                // Total: 14B, 11R. Close enough. Let's stick to 15B 10R.
                // Col 1: B B B B B (5B)
                // Col 2: B B B B R (4B 1R)
                // Col 3: B B R R R (2B 3R)
                // Col 4: R R R R B (1B 4R)
                // Col 5: R B B B B (4B 1R) -- Too many B.
                
                // Optimized Layout for Gerrymandering Logic:
                voters: [
                    'R','R','B','B','B',
                    'R','R','B','B','B',
                    'R','R','B','B','B',
                    'R','R','B','B','B',
                    'R','R','B','B','B' 
                ], 
                // Total: 10 R, 15 B.
                // Fair Map (Vertical Columns): 
                // Cols 1&2 are R (2 districts). Cols 3,4,5 are B (3 districts).
                // Result: 3 Blue, 2 Red. (Perfectly Proportional).
                
                paths: [
                   "M 100 0 L 100 500", // Vertical line after col 1
                   "M 200 0 L 200 500", // Vertical line after col 2
                   "M 300 0 L 300 500",
                   "M 400 0 L 400 500"
                ],
                wins: { blue: 3, red: 2 },
                desc: "Vertical Districts: Borders follow logical straight lines. Representation (3 Blue, 2 Red) matches the population ratio (60/40).",
                winner: "Blue Wins (Fair)"
            },
            
            'crack': {
                // Goal: RED WINS. (Minority Rule).
                // We need 3 Red Districts.
                // Each District needs 3 R and 2 B.
                // Total R needed: 9. We have 10. Perfect.
                // District 1 (Horizontal Row 1): 2R, 3B -> Blue Wins.
                // District 2 (Horizontal Row 2): 2R, 3B -> Blue Wins.
                // ... If we do horizontal, Blue wins all 5 (5-0). That's "Cracking Red".
                
                // Wait, "Cracking Red" means splitting Red up so they lose.
                // Let's rename scenario to "Blue Dominance (Cracking Red)".
                // Horizontal Rows: Each row is R R B B B.
                // Result: Blue wins every single district 3-2.
                // Total: 5 Blue, 0 Red.
                
                paths: [
                   "M 0 100 L 500 100", // Horizontal line 1
                   "M 0 200 L 500 200",
                   "M 0 300 L 500 300",
                   "M 0 400 L 500 400"
                ],
                wins: { blue: 5, red: 0 },
                desc: "Horizontal Districts (Cracking): The minority (Red) is spread out across all districts. They never have a majority. Blue wins 100% of seats with only 60% of votes.",
                winner: "Blue Sweeps (Cracking)"
            },

            'pack': {
                // Goal: RED WINS (Minority Rule).
                // This is usually done by "Packing" Blue into super-majorities to waste their votes.
                // We need Red to win 3 districts.
                // Let's create shapes. 
                // Shape 1: 5 Blues packed together. (Blue wins 5-0).
                // Shape 2: 5 Blues packed together. (Blue wins 5-0).
                // Remaining: 10 Reds, 5 Blues.
                // We have 3 districts left. We need Red to win all 3.
                // Dist 3: 3R, 2B. (Red wins).
                // Dist 4: 3R, 2B. (Red wins).
                // Dist 5: 4R, 1B. (Red wins).
                // Total Result: Red wins 3, Blue wins 2.
                // RED (THE MINORITY) WINS THE ELECTION.
                
                // Let's draw the paths for this.
                // Pack 1: Top Right 5 blocks.
                // Pack 2: Bottom Right 5 blocks.
                // Leftover is the left 2 columns + middle column bits.
                
                // This is hard to draw generically. Let's use a specific wacky path set.
                // Simple logic: 
                // D1 (Red Win): Top Left 2x2 + one neighbor? No, grid is 5x5.
                // Let's define the paths manually for visual clarity.
                
                // Let's try the "Packing Blue" strategy but visually represented as snakey lines.
                // D1: Col 3 (B), Col 4 (B), Col 5 (B). 
                // Let's make 2 districts that are 100% Blue.
                // D1: Row 1, Cols 3-5 (3B) + Row 2, Cols 4-5 (2B).
                
                // Actually, let's switch the logic for simplicity of code.
                // I will hardcode the SVG paths for a "Gerrymander" map that makes Red Win.
                paths: [
                    "M 200 0 L 200 500", // Split off the 2 Left columns of Reds
                    // Now we have a block of 10 Reds on left. 
                    // We need to mix them with just enough Blues.
                    // Let's make the lines wiggle.
                    // This is complex to draw procedurally.
                    // Instead, I will simply explain the concept with the Horizontal/Vertical demo,
                    // OR I can make a "Minority Rule" preset with a specific complex path.
                    
                    // Let's stick to the 3rd scenario being "Minority Rule".
                    // How to get Red (10 voters) to win 3 districts?
                    // They need 3 districts of (3R, 2B). Uses 9R, 6B.
                    // Remaining: 1R, 9B.
                    // Those remaining are packed into 2 districts.
                    // Visualizing this on the grid:
                    // R R B B B
                    // R R B B B
                    // R R B B B
                    // R R B B B
                    // R R B B B
                    
                    // District 1 (Red Win): R(0,0), R(0,1), R(1,0), B(0,2), B(1,2)? No adjacency issues.
                    // Let's just draw boxes around groupings.
                    
                    // Box 1 (Red Win): Top-Left 6 squares (2 rows x 3 cols)? No that's 6.
                    // We'll use a custom SVG path that looks 'gerrymandered' (weird shapes).
                    "M 0 100 L 200 100 L 200 0", // Cut top left corner
                    // ... this is getting too manual for a chat response.
                    
                    // ALTERNATIVE: Simplest "Minority Rule" Grid.
                    // R R R B B
                    // R R R B B
                    // R R R B B  <- these 3 rows are Red districts.
                    // B B B B B  <- these 2 rows are Blue districts.
                    // B B B B B
                    // If I change the voter array just for this scenario, it's cheating.
                    // But wait! My voter array is:
                    // R R B B B
                    // R R B B B
                    // ...
                    // If I group them as:
                    // D1: R R (row1) + R (row2) + B B (row1). (3R 2B) -> Red Win.
                    // This requires zig-zag lines.
                    
                    // Zig Zag Lines for "Pack Blue / Minority Rule":
                    // D1: (0,0)(1,0)(0,1) + (0,2)(1,2) [3R 2B] - Win
                    // D2: (2,0)(3,0)(2,1) + (2,2)(3,2) [3R 2B] - Win
                    // D3: (4,0)(4,1)(3,1) + (4,2)(something)
                    
                    // Let's just implement the "Cracking" scenario well, and a "Packed" scenario that shows 5-0 blue.
                    // And maybe a "Gerrymander" that lets Red win.
                    // I will use a simplified visual representation for the 'Red Wins' that basically creates C-shapes.
                ],
                // Let's use a simpler geometry for the 3rd scenario to ensure it works reliably.
                // We will stick to:
                // 1. Vertical (Fair)
                // 2. Horizontal (Blue Sweep/Cracking)
                // 3. "Gerrymander" (Red Wins) - manually defined complex paths.
                pathCustom: true, 
                wins: { blue: 2, red: 3 },
                desc: "Gerrymandered (Packing Blue): Blue voters are 'packed' into 2 districts with huge majorities (100% Blue). Their votes are wasted there. Red wins the other 3 districts with slim margins. The Minority wins.",
                winner: "Red Wins (Gerrymander)"
            }
        };

        // --- Render Logic ---
        
        const gridEl = document.getElementById('voter-grid');
        const svgEl = document.getElementById('district-overlay');
        
        // Render Voters
        const voters = [
            'R','R','B','B','B',
            'R','R','B','B','B',
            'R','R','B','B','B',
            'R','R','B','B','B',
            'R','R','B','B','B' 
        ];

        voters.forEach(type => {
            const div = document.createElement('div');
            div.className = `w-full h-full rounded-full shadow-sm ${type === 'B' ? 'bg-blue-500' : 'bg-red-500'} voter transform scale-90`;
            gridEl.appendChild(div);
        });

        function setScenario(type) {
            // Update Buttons
            ['fair', 'crack', 'pack'].forEach(k => {
                const btn = document.getElementById(`btn-${k}`);
                if (k === type) {
                    btn.className = "px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 font-bold text-sm transition shadow-md ring-2 ring-offset-2 ring-indigo-500";
                } else {
                    btn.className = "px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50 font-bold text-sm transition";
                }
            });

            const data = scenarios[type];
            
            // Update Text
            document.getElementById('score-blue').innerText = data.wins.blue;
            document.getElementById('score-red').innerText = data.wins.red;
            document.getElementById('scenario-desc').innerText = data.desc;
            document.getElementById('election-winner').innerText = data.winner;
            
            // Color Winner Text
            const winEl = document.getElementById('election-winner');
            if(data.winner.includes("Blue")) winEl.className = "text-2xl font-bold text-blue-600";
            else winEl.className = "text-2xl font-bold text-red-600";

            // Draw Lines
            svgEl.innerHTML = ''; // Clear
            
            if (type === 'pack') {
                // Complex custom path for Red Win
                // We need to visually separate the 1st two columns (Red) into 3 chunks, 
                // mixed with bits of column 3 (Blue).
                // Then pack cols 4 & 5 into 2 districts.
                
                // District 4 (Blue Pack): Cols 4&5, Row 1-2, plus half row 3.
                // District 5 (Blue Pack): Cols 4&5, Row 4-5, plus half row 3.
                // This is hard to code as a path without a path generator.
                
                // TRICK: I will just draw the specific lines needed for the logic described.
                // We simulate 3 Horizontal districts on the left (3x5 grid area roughly)
                // And 2 Vertical districts on the right.
                // Line 1: Vertical down the middle (splitting col 3 and 4). M 300 0 L 300 500.
                // Line 2: Horizontal split on left side. M 0 166 L 300 166.
                // Line 3: Horizontal split on left side. M 0 333 L 300 333.
                // Line 4: Horizontal split on right side? No, lets split right side vertically. No, grid is 5x5.
                
                // Let's keep it simple visual:
                // 1. Vertical Line at x=300 (Separates Left 3 cols from Right 2 cols).
                // 2. Horizontal Lines at y=166 and y=333 on the LEFT side only.
                // 3. Horizontal Line at y=250 on the RIGHT side only.
                
                // Result Analysis of this map:
                // Left Districts (contain Cols 1,2,3):
                // - Each has 2 Red, 1 Blue per row approx. 
                // - Actually Col 1=R, Col 2=R, Col 3=B. 
                // - So a slice includes R, R, B. -> RED WINS (2-1).
                // - We have 3 such slices. Red wins 3 districts.
                
                // Right Districts (contain Cols 4,5):
                // - Col 4=B, Col 5=B.
                // - A slice includes B, B. -> BLUE WINS (100%).
                // - We have 2 such slices. Blue wins 2 districts.
                
                // Total: Red wins 3, Blue wins 2.
                // THIS WORKS PERFECTLY.
                
                const paths = [
                    "M 300 0 L 300 500", // Vertical separator
                    "M 0 166 L 300 166", // Left Horizontal 1
                    "M 0 333 L 300 333", // Left Horizontal 2
                    "M 300 250 L 500 250" // Right Horizontal Split
                ];
                
                paths.forEach(d => drawPath(d, "#1e293b")); // Slate-800 lines
                
            } else {
                // Standard Paths from data
                data.paths.forEach(d => drawPath(d, "#1e293b"));
            }
        }

        function drawPath(d, color) {
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute("d", d);
            path.setAttribute("stroke", color);
            path.setAttribute("class", "district-border animate-draw");
            svgEl.appendChild(path);
        }

        // Initialize
        setScenario('fair');

    </script>
</body>
</html>
