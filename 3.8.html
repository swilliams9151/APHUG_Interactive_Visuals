<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APHG Topic 3.8: Effects of Diffusion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        canvas { background-color: #f8fafc; border-radius: 0.75rem; box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06); }
        
        /* Card Animation */
        .info-card {
            animation: slideInRight 0.3s ease-out;
        }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-violet-800 text-white p-4 shadow-lg shrink-0 z-20">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-extrabold">Topic 3.8: Effects of Diffusion</h1>
                <p class="text-violet-200 text-xs mt-1">Acculturation, Assimilation, Syncretism, and Multiculturalism</p>
            </div>
            <div class="text-xs bg-violet-700 px-3 py-1 rounded border border-violet-600">
                SPS-3.B.1
            </div>
        </div>
    </header>

    <main class="flex-1 flex flex-col md:flex-row max-w-7xl mx-auto w-full overflow-hidden p-4 gap-4">

        <!-- LEFT: CONTROLS -->
        <section class="w-full md:w-1/4 flex flex-col gap-4">
            
            <div class="bg-white p-4 rounded-xl shadow-md border border-slate-200">
                <h3 class="font-bold text-slate-700 mb-3 text-sm uppercase tracking-wider">Select Process</h3>
                <div class="space-y-2">
                    <button onclick="setMode('acculturation')" id="btn-acculturation" class="w-full text-left px-4 py-3 rounded-lg border-2 border-violet-500 bg-violet-50 text-violet-900 font-bold text-sm transition">
                        1. Acculturation
                    </button>
                    <button onclick="setMode('assimilation')" id="btn-assimilation" class="w-full text-left px-4 py-3 rounded-lg border-2 border-transparent bg-slate-100 text-slate-600 hover:bg-slate-200 font-bold text-sm transition">
                        2. Assimilation
                    </button>
                    <button onclick="setMode('syncretism')" id="btn-syncretism" class="w-full text-left px-4 py-3 rounded-lg border-2 border-transparent bg-slate-100 text-slate-600 hover:bg-slate-200 font-bold text-sm transition">
                        3. Syncretism
                    </button>
                    <button onclick="setMode('multiculturalism')" id="btn-multiculturalism" class="w-full text-left px-4 py-3 rounded-lg border-2 border-transparent bg-slate-100 text-slate-600 hover:bg-slate-200 font-bold text-sm transition">
                        4. Multiculturalism
                    </button>
                </div>
            </div>

            <div class="bg-white p-4 rounded-xl shadow-md border border-slate-200 flex-1 flex flex-col justify-center items-center text-center">
                <p class="text-xs text-slate-400 mb-2">Interact with the simulation</p>
                <button onclick="addMigrants()" class="bg-slate-800 text-white hover:bg-slate-700 px-6 py-3 rounded-full font-bold shadow-lg transition transform active:scale-95 flex items-center gap-2">
                    <span class="text-xl">+</span> Add New Culture
                </button>
                <p class="text-[10px] text-slate-400 mt-2">Adds "Red" particles to the "Blue" society.</p>
            </div>

        </section>

        <!-- CENTER: SIMULATION -->
        <section class="flex-1 bg-white rounded-xl shadow-inner border border-slate-300 relative overflow-hidden flex items-center justify-center">
            <canvas id="simCanvas" class="w-full h-full"></canvas>
            
            <!-- Simulation Legend -->
            <div class="absolute top-4 left-4 bg-white/90 backdrop-blur px-3 py-2 rounded-lg shadow text-xs border border-slate-200">
                <div class="flex items-center gap-2 mb-1">
                    <span class="w-3 h-3 rounded-full bg-blue-500"></span> Host Culture
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-3 h-3 rounded-full bg-red-500"></span> Incoming Culture
                </div>
                <div id="legend-extra" class="hidden flex items-center gap-2 mt-1">
                    <span class="w-3 h-3 rounded-full bg-purple-500"></span> Syncretic Mix
                </div>
            </div>
        </section>

        <!-- RIGHT: EXPLANATION -->
        <section class="w-full md:w-1/4 bg-white p-6 rounded-xl shadow-lg border-l-4 border-violet-500 overflow-y-auto">
            <div id="info-container">
                <!-- Dynamic Content -->
            </div>
        </section>

    </main>

    <script>
        // --- SIMULATION ENGINE ---
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        
        let width, height;
        let particles = [];
        let mode = 'acculturation';
        let animationId;

        // Resize handling
        function resize() {
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
            width = canvas.width;
            height = canvas.height;
        }
        window.addEventListener('resize', resize);
        resize();

        class Particle {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.type = type; // 'host' (blue), 'migrant' (red), 'mixed' (purple)
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.radius = 6;
                this.alpha = 1;
                
                // For Assimilation
                this.assimilationProgress = 0; 
            }

            update() {
                // Movement
                if (mode === 'multiculturalism' && this.type === 'migrant') {
                    // Cluster logic: Migrants attracted to center, Hosts repel slightly
                    const dx = (width/2) - this.x;
                    const dy = (height/2) - this.y;
                    this.vx += dx * 0.001;
                    this.vy += dy * 0.001;
                } 

                this.x += this.vx;
                this.y += this.vy;

                // Bounce
                if (this.x < 0 || this.x > width) this.vx *= -1;
                if (this.y < 0 || this.y > height) this.vy *= -1;

                // MODE LOGIC
                if (mode === 'assimilation' && this.type === 'migrant') {
                    // Slowly turn blue
                    this.assimilationProgress += 0.005;
                    if (this.assimilationProgress > 1) {
                        this.type = 'host'; // Fully assimilated
                        this.assimilationProgress = 0;
                    }
                } else if (mode === 'syncretism') {
                    // Check collisions to spawn purple
                    for (let other of particles) {
                        if (this !== other && this.type !== other.type && this.type !== 'mixed' && other.type !== 'mixed') {
                            const dx = this.x - other.x;
                            const dy = this.y - other.y;
                            const dist = Math.sqrt(dx*dx + dy*dy);
                            
                            if (dist < 20) {
                                // Create Syncretic particle chance
                                if (Math.random() < 0.01) {
                                    particles.push(new Particle((this.x+other.x)/2, (this.y+other.y)/2, 'mixed'));
                                    // Push parents away
                                    this.vx *= -2;
                                    other.vx *= -2;
                                }
                            }
                        }
                    }
                }
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                
                if (this.type === 'host') {
                    ctx.fillStyle = '#3b82f6'; // Blue
                } else if (this.type === 'mixed') {
                    ctx.fillStyle = '#a855f7'; // Purple
                } else if (this.type === 'migrant') {
                    if (mode === 'assimilation') {
                        // Interpolate Red to Blue
                        // Red: 239, 68, 68 (#ef4444)
                        // Blue: 59, 130, 246 (#3b82f6)
                        const p = this.assimilationProgress;
                        const r = Math.round(239 * (1-p) + 59 * p);
                        const g = Math.round(68 * (1-p) + 130 * p);
                        const b = Math.round(68 * (1-p) + 246 * p);
                        ctx.fillStyle = `rgb(${r},${g},${b})`;
                    } else if (mode === 'acculturation') {
                        // Red core with Blue border (Adopts traits, keeps ID)
                        ctx.fillStyle = '#ef4444';
                        ctx.strokeStyle = '#3b82f6';
                        ctx.lineWidth = 3;
                        ctx.stroke();
                    } else {
                        ctx.fillStyle = '#ef4444'; // Red
                    }
                }
                
                ctx.fill();
            }
        }

        // Init Population
        function initPop() {
            particles = [];
            // 40 Host particles
            for(let i=0; i<40; i++) {
                particles.push(new Particle(Math.random()*width, Math.random()*height, 'host'));
            }
        }

        function animate() {
            ctx.clearRect(0, 0, width, height);
            particles.forEach(p => {
                p.update();
                p.draw();
            });
            animationId = requestAnimationFrame(animate);
        }

        // --- UI LOGIC ---

        const definitions = {
            'acculturation': {
                title: "Acculturation",
                def: "An immigrant group adopts the values and practices of the larger group, while still maintaining major elements of their own culture.",
                visual: "Look at the particles: They are Red (distinct identity) but have a Blue border (adopted traits).",
                example: "<strong>Example:</strong> A family immigrates to the US. They speak English at work/school (Blue trait) but speak Spanish and eat traditional food at home (Red core)."
            },
            'assimilation': {
                title: "Assimilation",
                def: "The complete loss of original cultural traits as a group becomes indistinguishable from the dominant culture.",
                visual: "Look at the particles: The Red particles slowly fade and turn completely Blue. They disappear into the crowd.",
                example: "<strong>Example:</strong> Grandchildren of immigrants who no longer speak the ancestral language or practice traditional customs. The 'Melting Pot' ideal."
            },
            'syncretism': {
                title: "Syncretism",
                def: "The blending of traits from two different cultures to form a new, distinct cultural trait.",
                visual: "Look at the particles: When Red and Blue collide, they create PURPLE. Purple is something brand new.",
                example: "<strong>Example:</strong> <em>Santeria</em> (Catholic saints + African deities) or <em>Tex-Mex</em> cuisine (Mexican recipes + American ingredients)."
            },
            'multiculturalism': {
                title: "Multiculturalism",
                def: "The coexistence of several distinct cultural or ethnic groups within a society.",
                visual: "Look at the particles: The Red particles cluster together (like a neighborhood). They remain distinctly Red within the Blue space.",
                example: "<strong>Example:</strong> The 'Salad Bowl' concept. Distinct neighborhoods like Chinatown or Little Italy where culture is preserved publicly."
            }
        };

        function setMode(newMode) {
            mode = newMode;
            
            // Update Buttons
            ['acculturation', 'assimilation', 'syncretism', 'multiculturalism'].forEach(m => {
                const btn = document.getElementById(`btn-${m}`);
                if (m === mode) {
                    btn.className = "w-full text-left px-4 py-3 rounded-lg border-2 border-violet-500 bg-violet-50 text-violet-900 font-bold text-sm transition";
                } else {
                    btn.className = "w-full text-left px-4 py-3 rounded-lg border-2 border-transparent bg-slate-100 text-slate-600 hover:bg-slate-200 font-bold text-sm transition";
                }
            });

            // Update Info
            const info = definitions[mode];
            const container = document.getElementById('info-container');
            container.innerHTML = `
                <div class="info-card">
                    <h2 class="text-2xl font-bold text-violet-800 mb-4">${info.title}</h2>
                    
                    <div class="mb-6">
                        <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">Definition</h4>
                        <p class="text-slate-700 text-sm leading-relaxed">${info.def}</p>
                    </div>

                    <div class="mb-6 bg-violet-50 p-3 rounded border border-violet-100">
                        <h4 class="text-xs font-bold text-violet-400 uppercase tracking-wider mb-1">Visual Cue</h4>
                        <p class="text-violet-800 text-xs italic">${info.visual}</p>
                    </div>

                    <div class="border-t border-slate-200 pt-4">
                        <p class="text-slate-600 text-sm">${info.example}</p>
                    </div>
                </div>
            `;

            // Update Legend
            const legExtra = document.getElementById('legend-extra');
            if (mode === 'syncretism') legExtra.classList.remove('hidden');
            else legExtra.classList.add('hidden');

            // Reset Simulation for clarity
            initPop();
        }

        function addMigrants() {
            for(let i=0; i<10; i++) {
                particles.push(new Particle(Math.random()*width, Math.random()*height, 'migrant'));
            }
        }

        // Start
        initPop();
        animate();
        setMode('acculturation');

    </script>
</body>
</html>
