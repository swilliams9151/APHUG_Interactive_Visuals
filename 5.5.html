<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APHG Topic 5.5: The Green Revolution</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        #map { height: 100%; width: 100%; z-index: 0; }
        
        /* Wheat Animation */
        @keyframes grow {
            0% { transform: scaleY(0); }
            100% { transform: scaleY(1); }
        }
        .wheat-stalk {
            transform-origin: bottom;
            animation: grow 1s ease-out forwards;
        }

        /* Meter transitions */
        .meter-fill { transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.3s; }

        /* Tech Toggle */
        .tech-btn {
            transition: all 0.2s;
        }
        .tech-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .tech-btn.active {
            background-color: #f0fdf4;
            border-color: #16a34a;
            color: #166534;
            ring-width: 2px;
            ring-color: #16a34a;
        }
    </style>
</head>
<body class="bg-stone-100 text-stone-800 min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-lime-800 text-white p-6 shadow-lg shrink-0 z-10">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-extrabold">Topic 5.5: The Green Revolution</h1>
                <p class="text-lime-200 text-sm mt-1">High-Yield Seeds, Chemicals, and Mechanization (1960s-1980s)</p>
            </div>
            <div class="hidden md:block text-xs bg-lime-700 px-3 py-1 rounded border border-lime-600">
                SPS-5.D
            </div>
        </div>
    </header>

    <main class="flex-1 max-w-6xl mx-auto w-full p-6 space-y-10">

        <!-- SECTION 1: THE CROP LAB (Consequences) -->
        <section class="bg-white rounded-2xl shadow-xl border border-stone-200 overflow-hidden flex flex-col md:flex-row">
            
            <!-- Controls -->
            <div class="w-full md:w-1/3 p-6 bg-stone-50 border-r border-stone-200 flex flex-col gap-4">
                <h2 class="text-xl font-bold text-lime-900 mb-2">1. The Science Package</h2>
                <p class="text-xs text-stone-500 mb-4">Norman Borlaug's "Miracle Seeds" don't work alone. Add inputs to see the result.</p>

                <button onclick="toggleTech('seeds')" id="btn-seeds" class="tech-btn w-full text-left p-3 rounded border border-stone-300 bg-white font-bold text-sm flex items-center gap-2">
                    <span>ðŸ§¬</span> HYV Seeds (Miracle Rice/Wheat)
                </button>
                <button onclick="toggleTech('chem')" id="btn-chem" class="tech-btn w-full text-left p-3 rounded border border-stone-300 bg-white font-bold text-sm flex items-center gap-2">
                    <span>ðŸ§ª</span> Chemical Fertilizers/Pesticides
                </button>
                <button onclick="toggleTech('water')" id="btn-water" class="tech-btn w-full text-left p-3 rounded border border-stone-300 bg-white font-bold text-sm flex items-center gap-2">
                    <span>ðŸ’§</span> Irrigation Systems
                </button>
                <button onclick="toggleTech('mech')" id="btn-mech" class="tech-btn w-full text-left p-3 rounded border border-stone-300 bg-white font-bold text-sm flex items-center gap-2">
                    <span>ðŸšœ</span> Mechanization
                </button>

                <button onclick="resetLab()" class="mt-auto text-xs text-stone-400 underline hover:text-stone-600">Reset Farm</button>
            </div>

            <!-- Visualizer -->
            <div class="w-full md:w-2/3 p-8 flex flex-col gap-6 relative">
                
                <!-- The Field -->
                <div class="flex-1 relative bg-sky-100 rounded-xl border-b-8 border-amber-700 overflow-hidden flex items-end justify-center px-4">
                    <div id="sky-overlay" class="absolute inset-0 bg-transparent transition-colors duration-500"></div>
                    
                    <!-- Crop Container -->
                    <div id="crop-container" class="flex gap-1 items-end w-full justify-center">
                        <!-- Wheat stalks go here -->
                    </div>

                    <!-- Machine Overlay -->
                    <div id="tractor" class="absolute bottom-2 right-[-100px] text-6xl transition-all duration-1000 opacity-0">ðŸšœ</div>
                </div>

                <!-- Meters -->
                <div class="grid grid-cols-3 gap-4">
                    <!-- Food Supply -->
                    <div>
                        <div class="flex justify-between text-[10px] font-bold text-stone-500 uppercase mb-1">
                            <span>Food Yield</span>
                            <span id="val-food" class="text-emerald-600">Low</span>
                        </div>
                        <div class="w-full h-2 bg-stone-200 rounded-full overflow-hidden">
                            <div id="bar-food" class="h-full bg-emerald-500 meter-fill" style="width: 20%"></div>
                        </div>
                    </div>

                    <!-- Environmental Cost -->
                    <div>
                        <div class="flex justify-between text-[10px] font-bold text-stone-500 uppercase mb-1">
                            <span>Enviro Damage</span>
                            <span id="val-env" class="text-emerald-600">None</span>
                        </div>
                        <div class="w-full h-2 bg-stone-200 rounded-full overflow-hidden">
                            <div id="bar-env" class="h-full bg-emerald-500 meter-fill" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- Social Cost -->
                    <div>
                        <div class="flex justify-between text-[10px] font-bold text-stone-500 uppercase mb-1">
                            <span>Small Farmer Debt</span>
                            <span id="val-soc" class="text-emerald-600">Low</span>
                        </div>
                        <div class="w-full h-2 bg-stone-200 rounded-full overflow-hidden">
                            <div id="bar-soc" class="h-full bg-emerald-500 meter-fill" style="width: 10%"></div>
                        </div>
                    </div>
                </div>

                <!-- Alert Box -->
                <div id="lab-alert" class="hidden bg-stone-100 p-3 rounded border-l-4 border-stone-400 text-xs text-stone-600 italic">
                    Select inputs to see results.
                </div>

            </div>
        </section>

        <!-- SECTION 2: GEOGRAPHIC IMPACT (Map) -->
        <section class="bg-white rounded-2xl shadow-xl border border-stone-200 h-[450px] flex flex-col">
            <div class="p-4 border-b border-stone-100 flex justify-between items-center">
                <h2 class="text-xl font-bold text-stone-800">2. Where did it happen?</h2>
                <div class="text-xs space-x-2">
                    <span class="inline-block w-3 h-3 bg-emerald-500 rounded-full"></span> Success Story
                    <span class="inline-block w-3 h-3 bg-red-500 rounded-full"></span> Limited Success
                </div>
            </div>
            <div class="flex-1 relative">
                <div id="map"></div>
                
                <!-- Floating Info Panel -->
                <div id="map-info" class="absolute bottom-6 left-6 bg-white/90 backdrop-blur p-4 rounded-xl shadow-lg w-72 border border-stone-200 z-[1000] hidden transition-all">
                    <h3 id="region-title" class="font-bold text-lg text-stone-800 mb-1">Region</h3>
                    <p id="region-desc" class="text-xs text-stone-600 leading-relaxed">Description...</p>
                </div>
            </div>
        </section>

        <!-- SECTION 3: PROS & CONS SORT (SPS-5.D.2) -->
        <section>
            <h2 class="text-2xl font-bold text-stone-800 mb-6 pl-4 border-l-4 border-lime-600">3. Assessing Consequences</h2>
            <div class="grid md:grid-cols-2 gap-8">
                
                <!-- Positive -->
                <div class="bg-emerald-50 p-6 rounded-xl border border-emerald-100">
                    <h3 class="text-lg font-bold text-emerald-900 mb-4 flex items-center"><span class="text-2xl mr-2">ðŸ“ˆ</span> Positive Effects</h3>
                    <ul class="space-y-3 text-sm text-emerald-800">
                        <li class="flex items-start"><span class="mr-2 font-bold">âœ“</span> <strong>Averted Famine:</strong> India became self-sufficient in grain by the 1970s.</li>
                        <li class="flex items-start"><span class="mr-2 font-bold">âœ“</span> <strong>Lower Food Prices:</strong> Massive supply reduced costs for the global poor.</li>
                        <li class="flex items-start"><span class="mr-2 font-bold">âœ“</span> <strong>Profit:</strong> Agribusinesses and chemical companies saw huge growth.</li>
                    </ul>
                </div>

                <!-- Negative -->
                <div class="bg-red-50 p-6 rounded-xl border border-red-100">
                    <h3 class="text-lg font-bold text-red-900 mb-4 flex items-center"><span class="text-2xl mr-2">ðŸ“‰</span> Negative Effects</h3>
                    <ul class="space-y-3 text-sm text-red-800">
                        <li class="flex items-start"><span class="mr-2 font-bold">âœ—</span> <strong>Environmental Damage:</strong> Runoff causes algae blooms; soil salinization from over-irrigation.</li>
                        <li class="flex items-start"><span class="mr-2 font-bold">âœ—</span> <strong>Gender Gap:</strong> Mechanization displaced women who did manual weeding/harvesting.</li>
                        <li class="flex items-start"><span class="mr-2 font-bold">âœ—</span> <strong>Debt:</strong> Small farmers couldn't afford the expensive seeds/chemicals and sold land to corporations.</li>
                    </ul>
                </div>

            </div>
        </section>

    </main>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // --- 1. FARM LAB LOGIC ---
        const state = {
            seeds: false,
            chem: false,
            water: false,
            mech: false
        };

        function toggleTech(id) {
            state[id] = !state[id];
            const btn = document.getElementById(`btn-${id}`);
            
            if (state[id]) btn.classList.add('active');
            else btn.classList.remove('active');

            updateFarm();
        }

        function updateFarm() {
            // Calculating scores (0-100)
            let yieldScore = 20; // Base subsistence
            let envScore = 5;    // Low impact base
            let socScore = 10;   // Low debt base

            if (state.seeds) {
                yieldScore += 20;
                socScore += 20; // Seeds are expensive (IP)
            }
            
            // Chemicals only boost if seeds are present, but hurt environment regardless
            if (state.chem) {
                if (state.seeds) yieldScore += 30;
                envScore += 40; // Pollution
                socScore += 10; // Cost
            }

            // Water boosts yield but risks salinization
            if (state.water) {
                yieldScore += 20;
                envScore += 20; // Depletion/Salinization
                socScore += 10;
            }

            // Mechanization reduces labor (Social cost for laborers) but boosts efficiency
            if (state.mech) {
                yieldScore += 10; // Efficiency
                socScore += 30; // Displaces workers/High capital cost
                envScore += 10; // Fossil fuels
                
                // Animate tractor
                document.getElementById('tractor').style.opacity = 1;
                document.getElementById('tractor').style.right = "50%";
            } else {
                document.getElementById('tractor').style.opacity = 0;
                document.getElementById('tractor').style.right = "-100px";
            }

            // Visualizing Wheat
            const container = document.getElementById('crop-container');
            container.innerHTML = '';
            // Wheat count based on yield
            const stalks = Math.floor(yieldScore / 5); 
            let color = state.chem ? "#22c55e" : "#84cc16"; // Greener with fertilizer
            let heightClass = state.seeds ? "h-24" : "h-12"; // Taller with HYV

            for(let i=0; i<stalks; i++) {
                const wheat = document.createElement('div');
                wheat.className = `w-2 ${heightClass} rounded-t-full wheat-stalk mx-0.5`;
                wheat.style.backgroundColor = color;
                wheat.style.animationDelay = `${i * 0.05}s`;
                container.appendChild(wheat);
            }

            // Update Bars
            updateMeter('food', yieldScore, "emerald");
            updateMeter('env', envScore, envScore > 50 ? "red" : "emerald");
            updateMeter('soc', socScore, socScore > 50 ? "red" : "emerald");

            // Alert Logic
            const alert = document.getElementById('lab-alert');
            if (yieldScore > 80 && envScore > 60) {
                alert.className = "bg-red-100 p-3 rounded border-l-4 border-red-500 text-xs text-red-800 font-bold";
                alert.innerHTML = "Warning: High Yield achieved, but Environmental Damage is critical. Groundwater depletion likely.";
                alert.classList.remove('hidden');
            } else if (yieldScore > 80) {
                alert.className = "bg-emerald-100 p-3 rounded border-l-4 border-emerald-500 text-xs text-emerald-800 font-bold";
                alert.innerHTML = "Success: You have averted famine (Malthus was wrong!).";
                alert.classList.remove('hidden');
            } else {
                alert.classList.add('hidden');
            }
        }

        function updateMeter(id, val, colorName) {
            const bar = document.getElementById(`bar-${id}`);
            const text = document.getElementById(`val-${id}`);
            
            bar.style.width = `${val}%`;
            
            // Update color classes
            bar.className = `h-full meter-fill bg-${colorName}-500`;
            text.className = `text-${colorName}-600`;
            
            let label = "Low";
            if (val > 30) label = "Medium";
            if (val > 70) label = "High";
            if (val > 90) label = "Critical";
            text.innerText = label;
        }

        function resetLab() {
            state.seeds = false; state.chem = false; state.water = false; state.mech = false;
            document.querySelectorAll('.tech-btn').forEach(b => b.classList.remove('active'));
            updateFarm();
        }


        // --- 2. MAP LOGIC ---
        const locations = {
            'mexico': {
                coords: [23.6, -102.5],
                title: "Mexico (The Birthplace)",
                desc: "Norman Borlaug developed disease-resistant dwarf wheat here in the 1940s. Mexico went from importing corn to exporting it within 20 years.",
                color: "#10b981"
            },
            'india': {
                coords: [20.6, 79.0],
                title: "India (The Success)",
                desc: "Faced famine in the 1960s. Adopted IR8 Rice ('Miracle Rice'). Became self-sufficient in grain, though regional inequality (Punjab vs. Bihar) increased.",
                color: "#10b981"
            },
            'africa': {
                coords: [10.0, 20.0],
                title: "Sub-Saharan Africa (The Challenge)",
                desc: "The Green Revolution largely bypassed Africa. Why? Diverse climates, lack of infrastructure (roads/irrigation), and crops (Sorghum/Millet) were not researched as much as Wheat/Rice.",
                color: "#ef4444"
            }
        };

        window.onload = function() {
            const map = L.map('map', {
                center: [20, 0],
                zoom: 2,
                minZoom: 2,
                worldCopyJump: true,
                zoomControl: false
            });
            L.control.zoom({ position: 'bottomright' }).addTo(map);
            
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; CARTO',
                maxZoom: 19
            }).addTo(map);

            Object.keys(locations).forEach(k => {
                const loc = locations[k];
                const marker = L.circleMarker(loc.coords, {
                    radius: 10,
                    color: "white",
                    fillColor: loc.color,
                    fillOpacity: 0.8,
                    weight: 2
                }).addTo(map);

                marker.on('click', () => {
                    const info = document.getElementById('map-info');
                    document.getElementById('region-title').innerText = loc.title;
                    document.getElementById('region-title').style.color = loc.color;
                    document.getElementById('region-desc').innerText = loc.desc;
                    info.classList.remove('hidden');
                    map.flyTo(loc.coords, 3);
                });
            });
            
            // Init Farm
            updateFarm();
        };

    </script>
</body>
</html>
